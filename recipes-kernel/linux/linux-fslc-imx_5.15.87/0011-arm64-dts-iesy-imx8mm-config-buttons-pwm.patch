From 3f868071ba5f2dd19ac706e92c7955a5c956ee25 Mon Sep 17 00:00:00 2001
From: Dominik Poggel <pog@iesy.com>
Date: Wed, 8 Feb 2023 15:28:27 +0100
Subject: [PATCH 11/11] arm64: dts: iesy: imx8mm: config buttons, pwm

---
 .../boot/dts/iesy/iesy-imx8mm-eva-mi.dts      | 72 ++++++++++++++++++-
 1 file changed, 70 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/iesy/iesy-imx8mm-eva-mi.dts b/arch/arm64/boot/dts/iesy/iesy-imx8mm-eva-mi.dts
index e2c03fc6393c..bf5cc4116658 100755
--- a/arch/arm64/boot/dts/iesy/iesy-imx8mm-eva-mi.dts
+++ b/arch/arm64/boot/dts/iesy/iesy-imx8mm-eva-mi.dts
@@ -49,6 +49,25 @@
 		};
 	};
 
+	user-buttons {
+		compatible = "gpio-keys";
+		// autorepeat;
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_buttons>;
+
+		user-button-1 {
+			label = "User Button 1";
+			gpios = <&gpio1 8 GPIO_ACTIVE_LOW>;
+			linux,code = <KEY_X>;
+		};
+
+		user-button-2 {
+			label = "User Button 2";
+			gpios = <&gpio1 9 GPIO_ACTIVE_LOW>;
+			linux,code = <KEY_Y>;
+		};
+	};
+
 	// pcie0_refclk: pcie0-refclk {
 	// 	compatible = "fixed-clock";
 	// 	#clock-cells = <0>;
@@ -244,7 +263,7 @@
 &usbotg1 {
 	vbus-supply = <&reg_usb_a_vbus>;
 	over-current-active-low;
-	dr_mode = "host";
+	dr_mode = "otg";
 	pinctrl-names = "idle", "active";
 	pinctrl-0 = <&pinctrl_usb1_idle>;
 	pinctrl-1 = <&pinctrl_usb1_active>;
@@ -422,10 +441,16 @@
 	};
 
 	eeprom@50 {
-		compatible = "onsemi,24c32";
+		compatible = "onsemi,24c32", "at,24c32";
 		reg = <0x50>;
 		pagesize = <32>;
 	};
+
+	eeprom@51 {
+		compatible = "at,24c64";
+		reg = <0x51>;
+		pagesize = <64>;
+	};
 };
 
 &i2c2 {
@@ -440,6 +465,24 @@
 	};
 };
 
+&pwm1 {
+	status = "okay";
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm1>;
+};
+
+&pwm2 {
+	status = "okay";
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm2>;
+};
+
+&pwm3 {
+	status = "okay";
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm3>;
+};
+
 &iomuxc {
 	pinctrl-names = "default";
 
@@ -494,6 +537,13 @@
 		>;
 	};
 
+	pinctrl_buttons: gpiobuttongrp {
+		fsl,pins = <
+			MX8MM_IOMUXC_GPIO1_IO08_GPIO1_IO8	0x156
+			MX8MM_IOMUXC_GPIO1_IO09_GPIO1_IO9	0x156
+		>;
+	};
+
 	pinctrl_gpio_wlf: gpiowlfgrp {
 		fsl,pins = <
 			MX8MM_IOMUXC_I2C4_SDA_GPIO5_IO21	0xd6
@@ -794,6 +844,24 @@
 			MX8MM_IOMUXC_GPIO1_IO02_WDOG1_WDOG_B	0xc6
 		>;
 	};
+
+	pinctrl_pwm1: pwm1grp {
+		fsl,pins = <
+			MX8MM_IOMUXC_SPDIF_EXT_CLK_PWM1_OUT		0x116
+		>;
+	};
+
+	pinctrl_pwm2: pwm2grp {
+		fsl,pins = <
+			MX8MM_IOMUXC_SPDIF_RX_PWM2_OUT			0x116
+		>;
+	};
+
+	pinctrl_pwm3: pwm3grp {
+		fsl,pins = <
+			MX8MM_IOMUXC_SPDIF_TX_PWM3_OUT			0x116
+		>;
+	};
 };
 
 &lcdif {
-- 
2.30.2

